from pyrogram import Client
import asyncio
from datetime import datetime
from zoneinfo import ZoneInfo # Ù…Ø§Ú˜ÙˆÙ„ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ø§Ø·Ù‚ Ø²Ù…Ø§Ù†ÛŒ

# NOTE: For security, it is highly recommended to use environment variables
# instead of hardcoding sensitive data like API keys and phone numbers.

# Your credentials
api_id = 28190856
api_hash = "6b9b5309c2a211b526c6ddad6eabb521"
phone_number = "+989011243659"

# Initialize the Pyrogram client.
# The session name "my_account" will store your login details after the first run.
app = Client("my_account", api_id=api_id, api_hash=api_hash, phone_number=phone_number)

# ØªØ¹Ø±ÛŒÙ Ù…Ù†Ø·Ù‚Ù‡ Ø²Ù…Ø§Ù†ÛŒ ØªÙ‡Ø±Ø§Ù† Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø§Ú˜ÙˆÙ„ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
TEHRAN_TIMEZONE = ZoneInfo("Asia/Tehran")

async def update_name():
    """Continuously updates the user's first name with the current date and time in Tehran."""
    
    while True:
        # 1. Ú¯Ø±ÙØªÙ† Ø³Ø§Ø¹Øª ÙØ¹Ù„ÛŒ Ø§ÛŒØ±Ø§Ù† Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù…Ø§Ú˜ÙˆÙ„ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ (ZoneInfo)
        # Ø§Ú¯Ø± Ø³Ø§Ø¹Øª Ø§Ø´ØªØ¨Ø§Ù‡ Ø¨ÙˆØ¯ØŒ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø·Ù‚Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ø³ÛŒØ³ØªÙ… Ù…ÛŒØ²Ø¨Ø§Ù† Ø¨Ù‡â€ŒØ±ÙˆØ² Ù†Ø¨Ø§Ø´Ø¯.
        tehran_time = datetime.now(TEHRAN_TIMEZONE)
        
        # 2. ÙØ±Ù…Øª Ø¬Ø¯ÛŒØ¯: Ù†Ù…Ø§ÛŒØ´ Ø±ÙˆØ² (DD)ØŒ Ù…Ø§Ù‡ (MM) Ùˆ Ø³Ø§Ø¹Øª (HH:MM)
        # Ù…Ø«Ø§Ù„: 05.11 20:30
        current_display = tehran_time.strftime("%d.%m %H:%M")
        
        # Combine the fixed name part with the live clock and date
        name_with_clock = f"ğ“ğ‘’ ğ’¶ğ“‚ğ’¾ğ“‡ | {current_display}" # Ù†Ø§Ù… Ø·ÙˆÙ„Ø§Ù†ÛŒâ€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª
        
        try:
            # Update the profile (only the first_name is changed)
            await app.update_profile(first_name=name_with_clock)
            # Log the time being set
            print(f"[{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}] Updated name to: {name_with_clock}")
            
        except Exception as e:
            # Handle potential rate limits or connection errors
            print(f"Error updating name: {e}")
            
        # Wait for 60 seconds before the next update to avoid hitting rate limits
        await asyncio.sleep(60)

async def main():
    """Starts the client and runs the name update loop."""
    print("Starting Telegram Client...")
    await app.start()
    print("Client running. Starting name update loop.")
    
    # Run the update function
    await update_name()
    
    # If the update_name loop somehow finishes (it shouldn't, due to 'while True'),
    # the client should be stopped.
    await app.stop()

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\nBot stopped by user.")
    except Exception as e:
        print(f"An unexpected error occurred in main execution: {e}")
